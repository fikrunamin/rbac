<%- include('../layout', { title: 'Pesanan Pelanggan' }) %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2>Pesanan <%= pelanggan.nama %></h2>
      <p class="text-muted mb-0">
        Email: <%= pelanggan.email %><br>
        Telepon: <%= pelanggan.telepon || '-' %>
      </p>
    </div>
    <div>
      <a href="/pelanggan" class="btn btn-secondary me-2">Kembali</a>
      <a href="/pesanan/create?pelanggan_id=<%= pelanggan.id %>" class="btn btn-primary">Tambah Pesanan</a>
    </div>
  </div>

  <% if (messages.success) { %>
    <div class="alert alert-success">
      <%= messages.success %>
    </div>
  <% } %>

  <% if (messages.error) { %>
    <div class="alert alert-danger">
      <%= messages.error %>
    </div>
  <% } %>

  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>ID</th>
          <th>Tanggal</th>
          <th>Status</th>
          <th>Pembayaran</th>
          <th>Pengiriman</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <% pesanan.forEach(function(item) { %>
          <tr>
            <td><%= item.id %></td>
            <td><%= new Date(item.tanggal_pesanan).toLocaleDateString('id-ID') %></td>
            <td>
              <span class="badge bg-<%= {
                'pending': 'warning',
                'dibayar': 'info',
                'dikirim': 'primary',
                'selesai': 'success'
              }[item.status] %>"><%= item.status %></span>
            </td>
            <td>
              <% if (item.status === 'pending') { %>
                <a href="/pembayaran/<%= item.id %>" class="btn btn-sm btn-outline-primary">Proses Pembayaran</a>
              <% } else { %>
                <span class="badge bg-success">Sudah Dibayar</span>
              <% } %>
            </td>
            <td>
              <% if (item.status === 'dibayar') { %>
                <a href="/pengiriman/<%= item.id %>" class="btn btn-sm btn-outline-primary">Proses Pengiriman</a>
              <% } else if (item.status === 'dikirim' || item.status === 'selesai') { %>
                <span class="badge bg-success">Sudah Dikirim</span>
              <% } else { %>
                <span class="badge bg-secondary">Menunggu Pembayaran</span>
              <% } %>
            </td>
            <td>
              <a href="/pesanan/<%= item.id %>" class="btn btn-sm btn-info">Detail</a>
            </td>
          </tr>
        <% }); %>

        <% if (pesanan.length === 0) { %>
          <tr>
            <td colspan="6" class="text-center">Tidak ada pesanan</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>